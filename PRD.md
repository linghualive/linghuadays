# DaysMater - 倒数日应用功能需求文档

## 1. 产品概述

DaysMater 是一款基于 Flutter 的本地倒数日应用，支持公历（阳历）和农历（阴历）日期设置，帮助用户管理和追踪重要日期的倒计时或正计时。所有数据存储在本地，无需网络连接。

---

## 2. 核心功能

### 2.1 倒数日管理

#### 2.1.1 创建倒数日

- 用户可创建一个倒数日事件，需填写以下信息：
  - **事件名称**（必填）：如"妈妈生日"、"结婚纪念日"
  - **目标日期**（必填）：支持公历或农历选择
  - **日历类型**（必填）：公历 / 农历
  - **分类标签**（可选）：如生日、纪念日、节日、考试、自定义等
  - **备注**（可选）：补充说明
  - **是否每年重复**（可选）：开启后每年自动计算下一次倒计时
  - **提醒设置**（可选）：设置提前提醒的天数及提醒时间

#### 2.1.2 编辑倒数日

- 支持修改已创建倒数日的所有字段
- 修改日历类型时自动清空已选日期，要求重新选择

#### 2.1.3 删除倒数日

- 支持删除单个倒数日，删除前需二次确认
- 支持批量删除（长按进入多选模式）

#### 2.1.4 置顶倒数日

- 支持将重要事件置顶显示
- 置顶事件按置顶时间排序

### 2.2 日期系统

#### 2.2.1 公历（阳历）

- 标准公历日期选择器
- 支持年/月/日选择
- 日期范围：1900-01-01 至 2100-12-31

#### 2.2.2 农历（阴历）

- 农历日期选择器，显示天干地支年份、农历月份和日期
- 支持闰月选择（当年存在闰月时显示）
- 农历日期自动转换为对应公历日期进行计算
- 日期范围：农历 1900 年至 2100 年
- 创建后在列表中同时显示农历日期和对应的公历日期

#### 2.2.3 日期计算规则

- **未来日期**：显示"还有 X 天"（倒计时）
- **过去日期**：显示"已过 X 天"（正计时）
- **当天**：显示"就是今天"
- 每年重复的事件：自动计算距离下一次的天数
- 农历重复事件：每年根据农历日期重新推算对应公历日期

### 2.3 首页与列表

#### 2.3.1 首页展示

- 顶部突出显示一个"焦点事件"（用户可设置，默认为最近的倒数日）
- 焦点事件区域展示：事件名称、剩余/已过天数、目标日期
- 下方为倒数日列表

#### 2.3.2 列表展示

- 每条记录显示：事件名称、分类标签、剩余/已过天数、目标日期（公历+农历）
- 支持按以下方式排序：
  - 按剩余天数（默认）
  - 按创建时间
  - 按名称
- 支持按分类标签筛选

#### 2.3.3 搜索

- 支持按事件名称关键字搜索

### 2.4 提醒通知

- 支持为每个倒数日设置本地通知提醒
- 可设置提前提醒天数：当天、提前1天、提前3天、提前7天、自定义天数
- 可设置提醒时间（时:分）
- 每年重复的事件每年自动触发提醒

### 2.5 实时倒计时页面

#### 2.5.1 入口

- 在倒数日列表中点击某个未来事件，进入该事件的实时倒计时全屏页面
- 仅目标日期在未来的事件支持进入倒计时页面；已过期事件点击进入事件详情页，不显示倒计时

#### 2.5.2 页面布局

- 页面强制横屏显示（Landscape），全屏沉浸模式，隐藏状态栏和导航栏
- 页面顶部显示事件名称和目标日期
- 页面中央大字体显示实时倒计时，格式为：
  - **XX 天 XX 时 XX 分 XX 秒**
  - 天数、小时、分钟、秒数分别独立显示，秒数实时跳动
- 当剩余不足 24 小时时，隐藏"天"，仅显示时、分、秒
- 当剩余不足 1 小时时，隐藏"时"，仅显示分、秒
- 倒计时归零时显示庆祝动效（如撒花/烟花），并切换文案为"时刻已到"

#### 2.5.3 交互

- 点击屏幕任意位置切换显示/隐藏顶部信息栏（事件名称、返回按钮）
- 左上角返回按钮或向右滑动手势退出倒计时页面，恢复竖屏
- 支持屏幕常亮（进入倒计时页面后自动阻止息屏）

#### 2.5.4 视觉风格

- 深色背景，浅色数字，突出倒计时数字的视觉冲击力
- 数字使用等宽字体，避免跳动时宽度变化导致的抖动
- 分类标签颜色作为页面的点缀色（如数字颜色或底部装饰线）

### 2.6 倒数日卡片风格自定义

#### 2.6.1 内置卡片风格

- 提供多种预设卡片视觉风格，用户在创建或编辑倒数日时可选择：
  - **简约**：纯色背景 + 大号数字，干净利落
  - **渐变**：双色/多色渐变背景，现代感
  - **玻璃拟态**：半透明毛玻璃效果，模糊背景
  - **卡片阴影**：经典 Material 卡片，带投影层次
  - **深邃**：深色调背景 + 霓虹色数字，科技感
  - **手绘**：手绘风格边框和装饰元素
  - **节日**：针对特定节日的主题装饰（春节、圣诞、情人节等）
- 每种风格预设合理的配色方案，用户也可在风格基础上微调

#### 2.6.2 自定义选项

- **背景设置**：
  - 纯色 / 渐变色 / 自定义图片（从相册选取）
  - 图片支持模糊度调节和遮罩透明度调节，确保文字可读
- **数字/文字颜色**：自定义倒数天数数字和事件名称的颜色
- **字体风格**：
  - 内置多种字体供选择（至少包含）：
    - 系统默认字体
    - 等宽数字字体（如 Roboto Mono）
    - 圆体（如思源柔黑体风格）
    - 手写体（如 Ma Shan Zheng 风格）
    - 衬线体（如 Noto Serif SC 风格）
    - 像素字体（复古游戏风格）
  - 字体仅应用于倒数日卡片和倒计时页面的数字/标题区域
- **卡片圆角**：可调节卡片圆角大小

#### 2.6.3 风格预览

- 选择风格和自定义选项时提供实时预览
- 预览使用当前事件的实际数据（名称和天数）

#### 2.6.4 风格应用范围

- 卡片风格应用于首页列表中的事件卡片展示
- 字体风格同步应用于实时倒计时全屏页面
- 焦点事件区域使用对应事件的卡片风格

### 2.8 应用内更新

#### 2.8.1 自动检查更新

- 应用启动后延迟 2 秒自动检查 GitHub Releases 最新版本
- 如发现新版本且用户未跳过该版本，弹出更新对话框
- 无新版本或检查失败时静默不提示

#### 2.8.2 手动检查更新

- 设置页提供"检查更新"入口
- 手动检查始终显示结果（SnackBar 提示最新版本或网络错误）
- 发现新版本时弹出更新对话框

#### 2.8.3 更新对话框

- 标题"发现新版本"
- 显示版本变化（当前版本 → 最新版本）
- 使用 Markdown 格式渲染 Release Notes（可滚动，最大高度 300）
- 三个操作按钮：
  - **跳过此版本**：记录跳过的版本号，后续自动检查不再提示该版本
  - **稍后提醒**：关闭对话框，下次启动再检查
  - **立即更新**：触发更新操作

#### 2.8.4 Android APK 下载安装

- 优先使用镜像链接下载 APK，失败后回退原始链接
- 下载过程显示底部弹出进度面板：
  - 下载中：线性进度条 + 百分比
  - 安装中：不确定进度条
  - 失败：错误提示 + 重试按钮
- 下载完成后通过系统安装器安装 APK

#### 2.8.5 非 Android 平台

- 点击"立即更新"时通过浏览器打开 GitHub Release 页面

### 2.7 分类管理

- 预设分类：生日、纪念日、节日、工作、考试
- 支持用户自定义分类
- 每个分类可设置颜色标识
- 支持编辑和删除自定义分类（删除分类时该分类下的事件变为"未分类"）

---

## 3. 数据存储

### 3.1 本地存储

- 所有数据存储在设备本地，不依赖网络
- 使用本地数据库持久化存储（如 SQLite）
- 应用卸载后数据清除，需提前导出备份

### 3.2 数据导入导出

- 支持将所有倒数日数据导出为 JSON 文件
- 支持从 JSON 文件导入数据
- 导入时检测重复事件，提示用户选择覆盖或跳过

---

## 4. 界面与交互

### 4.1 主题

- 支持浅色模式和深色模式
- 支持跟随系统主题自动切换

### 4.2 多语言

- 首期支持中文（简体）
- 预留多语言扩展能力

### 4.3 交互细节

- 创建/编辑倒数日使用底部弹出的表单页面
- 日期选择器根据所选日历类型切换（公历滚轮选择器 / 农历滚轮选择器）
- 列表支持下拉刷新（重新计算所有倒计时天数）
- 长按列表项弹出快捷操作菜单（编辑、删除、置顶、设为焦点）

---

## 5. 平台支持

- iOS 和 Android 双平台
- 适配不同屏幕尺寸（手机）
- 支持横竖屏（优先竖屏体验）

---

## 6. 非功能性需求

| 类别 | 要求 |
|------|------|
| 性能 | 应用启动至首页可交互不超过 2 秒 |
| 存储 | 支持至少 1000 条倒数日记录 |
| 稳定性 | 农历转换算法需覆盖 1900-2100 年，确保准确性 |
| 隐私 | 纯本地应用，不采集任何用户数据，不请求非必要权限 |
| 无障碍 | 关键界面元素支持屏幕阅读器 |

